parameters:
  path: ''
  framework: ''
  frameworkGlobal: true

steps:
- ${{ if eq(parameters.frameworkGlobal, 'false') }}:
  - script: ${{ format('~/.dotnet/dotnet test -f {0} --no-build --logger trx -c Release /property:CollectCoverage=true /property:CoverletOutputFormat=cobertura /property:CoverletOutput=$(Build.SourcesDirectory)/results/coverage.cobertura.{0}.xml {1}', parameters.framework, parameters.path) }}
    displayName: ${{ format('dotnet test -f {0} *nix', parameters.framework) }}
    condition: ne(variables['Agent.OS'], 'Windows_NT')

  - task: PowerShell@2
    displayName: ${{ format('dotnet test -f {0} win', parameters.framework) }}
    inputs:
      targetType: inline
      script: ${{ format('dotnet test -f {0} --no-build --logger trx -c Release /property:CollectCoverage=true /property:CoverletOutputFormat=cobertura /property:CoverletOutput=$(Build.SourcesDirectory)/results/coverage.cobertura.{0}.xml {1}', parameters.framework, parameters.path) }}
    condition: eq(variables['Agent.OS'], 'Windows_NT')

- ${{ if eq(parameters.frameworkGlobal, 'true') }}:
  - task: DotNetCoreCLI@2
    displayName: ${{ format('dotnet test -f {0}', parameters.framework) }}
    inputs:
      command: test
      projects: ${{ parameters.path }}
      arguments: ${{ format('--no-build -f {0} -c Release /property:CollectCoverage=true /property:CoverletOutputFormat=cobertura /property:CoverletOutput=$(Build.SourcesDirectory)/results/coverage.cobertura.{0}.xml', parameters.framework) }}
      publishTestResults: true
